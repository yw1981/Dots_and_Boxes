var gameLogic;!function(a){function b(a,b){for(var c=[],d=0;a>d;d++){for(var e=[],f=0;b>f;f++)e[f]=[];c[d]=e}return c}function c(){var c={};c.isGameOver=!1,c.switchTurn=!0,c.sumAllEdges=0,c.score=[0,0],c.chains=[],c.hor=b(a.ROWSIZE+1,a.COLSIZE);for(var d=0;d<a.ROWSIZE+1;++d)for(var e=0;e<a.COLSIZE;++e)c.hor[d][e]=0;c.ver=b(a.ROWSIZE,a.COLSIZE+1);for(var d=0;d<a.ROWSIZE;++d)for(var e=0;e<a.COLSIZE+1;++e)c.ver[d][e]=0;c.color=b(a.ROWSIZE,a.COLSIZE),c.sum=b(a.ROWSIZE,a.COLSIZE);for(var d=0;d<a.ROWSIZE;++d)for(var e=0;e<a.COLSIZE;++e)c.color[d][e]="",c.sum[d][e]=0;return c}function d(b){if(b||console.log("board is undefined"),console.log("isGameOver="+b.isGameOver," switchTurn="+b.switchTurn," sumAllEdges="+b.sumAllEdges," score="+b.score),b.hor){var c="";c+="hor: [";for(var d=0;d<a.ROWSIZE+1;++d){c+="[";for(var e=0;e<a.COLSIZE;++e)c=c+b.hor[d][e]+", ";c+="]"}c+="]",console.log(c)}if(b.ver){var c="";c+="ver: [";for(var d=0;d<a.ROWSIZE;++d){c+="[";for(var e=0;e<a.COLSIZE+1;++e)c=c+b.ver[d][e]+", ";c+="]"}c+="]",console.log(c)}if(b.sum){var c="";c+="sum: [";for(var d=0;d<a.ROWSIZE;++d){c+="[";for(var e=0;e<a.COLSIZE;++e)c=c+b.sum[d][e]+", ";c+="]"}c+="]",console.log(c)}if(b.color){var c="";c+="color: [";for(var d=0;d<a.ROWSIZE;++d){c+="[";for(var e=0;e<a.COLSIZE;++e)c=c+b.color[d][e]+", ";c+="]"}c+="]",console.log(c)}}function e(a){var b="";b=a.dir+":"+a.row+"x"+a.col,console.log(b)}function f(b,c,d,e,f){var g=angular.copy(b);return"hor"===c?(g.hor[d][e]=1,0!==d&&(g.sum[d-1][e]+=1,4===g.sum[d-1][e]&&(g.switchTurn=!1,0===f?(g.color[d-1][e]="YOU",g.score[0]++):(g.color[d-1][e]="ME",g.score[1]++))),d!==a.ROWSIZE&&(g.sum[d][e]+=1,4===g.sum[d][e]&&(g.switchTurn=!1,0===f?(g.color[d][e]="YOU",g.score[0]++):(g.color[d][e]="ME",g.score[1]++)))):(g.ver[d][e]=1,0!==e&&(g.sum[d][e-1]+=1,4===g.sum[d][e-1]&&(g.switchTurn=!1,0===f?(g.color[d][e-1]="YOU",g.score[0]++):(g.color[d-1][e]="ME",g.score[1]++))),e!==a.COLSIZE&&(g.sum[d][e]+=1,4===g.sum[d][e]&&(g.switchTurn=!1,0===f?(g.color[d][e]="YOU",g.score[0]++):(g.color[d][e]="ME",g.score[1]++)))),g.sumAllEdges++,24===g.sumAllEdges&&(g.isGameOver=!0),g}function g(a,b,d,e,g){if(a||(a=c()),"hor"===b&&1===a.hor[d][e]||"ver"===b&&1===a.ver[d][e])throw new Error("One can only make a move in an empty position!");if(a.isGameOver)throw new Error("Can only make a move if the game is not over!");var h,i=f(a,b,d,e,g);h=i.isGameOver?{endMatch:{endMatchScores:i.score}}:i.switchTurn?{setTurn:{turnIndex:1-g}}:{setTurn:{turnIndex:g}};var j={dir:b,row:d,col:e};return[h,{set:{key:"board",value:i}},{set:{key:"delta",value:j}}]}function h(a){var b=a.move,c=a.turnIndexBeforeMove,d=a.stateBeforeMove;try{var e=b[2].set.value,f=e.dir,h=e.row,i=e.col,j=d.board,k=g(j,f,h,i,c);if(!angular.equals(b,k))return!1}catch(l){return!1}return!0}a.ROWSIZE=3,a.COLSIZE=3,a.getInitialBoard=c,a.printBoard=d,a.printDelta=e,a.updateBoard=f,a.createMove=g,a.isMoveOk=h}(gameLogic||(gameLogic={}));var game;!function(a){function b(){console.log("Translation of 'RULES_OF_DOTS_AND_BOXES' are "+translate("RULES_OF_DOTS_AND_BOXES")),resizeGameAreaService.setWidthToHeight(1),gameService.setGame({minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:gameLogic.isMoveOk,updateUI:e}),document.addEventListener("animationend",c,!1),document.addEventListener("webkitAnimationEnd",c,!1),document.addEventListener("oanimationend",c,!1)}function c(){$rootScope.$apply(function(){log.info("Animation ended"),n=!0,p&&d()})}function d(){gameService.makeMove(aiService.createComputerMove(q.board,r,{millisecondsLimit:1e3}))}function e(a){n=!1,q=a.stateAfterMove,q.board||(q.board=gameLogic.getInitialBoard()),o=a.turnIndexAfterMove>=0&&a.yourPlayerIndex===a.turnIndexAfterMove,r=a.turnIndexAfterMove,p=o&&""===a.playersInfo[a.yourPlayerIndex].playerId,p&&(o=!1,q.delta||d())}function f(a,b){if(log.info(["Clicked on cell:",a,b]),"?throwException"===window.location.search)throw new Error("Throwing the error because URL has '?throwException'");var c=g(a,b);""===c.dir?log.info("Clicked on non-action part"):h(c.dir,c.row,c.col)}function g(a,b){var c={};return(a+b)%2==0?c.dir="":a%2==0?(c.dir="hor",c.row=Math.floor(a/2),c.col=Math.floor(b/2)):(c.dir="ver",c.row=Math.floor(a/2),c.col=Math.floor(b/2)),c}function h(a,b,c){if(o)try{var d=gameLogic.createMove(q.board,a,b,c,r);o=!1,gameService.makeMove(d)}catch(e){return void log.info(["Cell is already full in position:",a,b,c])}}function i(a,b){var c=q.board.color[a][b];return""!==c}function j(a,b){return"YOU"===q.board.color[a][b]}function k(a,b){return"ME"===q.board.color[a][b]}function l(a,b){return!n&&q.delta&&q.delta.row===a&&q.delta.col===b}function m(a){return Math.floor(a/2)}var n=!1,o=!1,p=!1,q=null,r=null;a.isHelpModalShown=!1,a.init=b,a.cellClicked=f,a.shouldShowImage=i,a.isPieceX=j,a.isPieceO=k,a.shouldSlowlyAppear=l,a.divideByTwoThenFloor=m}(game||(game={})),angular.module("myApp",["ngTouch","ui.bootstrap","gameServices"]).run(function(){$rootScope.game=game,translate.setLanguage("en",{RULES_OF_DOTS_AND_BOXES:"Rules of Dots_and_Boxes",RULES_SLIDE1:"You and your opponent take turns to mark one empty edge but cannot complete a cell.",RULES_SLIDE2:"Whoever completes a cell earn one score. When all edges are filled, the player with higher score wins",CLOSE:"Close"}),game.init()});var aiService;!function(a){function b(a){return f(a.stateAfterMove.board,a.turnIndexAfterMove,{millisecondsLimit:1e3})}function c(a){return"dir:"+a.dir+"row:"+a.row+"col:"+a.col}function d(a,b,d,e,f){if(-1===f.indexOf(c(b)))if("hor"===b.dir){if(0===a.hor[b.row][b.col]){f.push(c(b));try{e.push(gameLogic.createMove(a,"hor",b.row,b.col,d))}catch(g){}}}else if("ver"===b.dir&&0===a.ver[b.row][b.col]){f.push(c(b));try{e.push(gameLogic.createMove(a,"ver",b.row,b.col,d))}catch(g){}}}function e(a,b){for(var c=[],e=[],f=0;f<gameLogic.ROWSIZE;++f)for(var g=0;g<gameLogic.COLSIZE;g++)3===a.sum[f][g]&&(d(a,{dir:"hor",row:f,col:g},b,c,e),d(a,{dir:"hor",row:f+1,col:g},b,c,e),d(a,{dir:"ver",row:f,col:g},b,c,e),d(a,{dir:"ver",row:f,col:g+1},b,c,e));if(c.length>=1)return c;for(var f=0;f<gameLogic.ROWSIZE;++f)for(var g=0;g<gameLogic.COLSIZE;g++)(0===a.sum[f][g]||1===a.sum[f][g])&&(d(a,{dir:"hor",row:f,col:g},b,c,e),d(a,{dir:"hor",row:f+1,col:g},b,c,e),d(a,{dir:"ver",row:f,col:g},b,c,e),d(a,{dir:"ver",row:f,col:g+1},b,c,e));if(c.length>=1)return c;for(var f=0;f<gameLogic.ROWSIZE;++f)for(var g=0;g<gameLogic.COLSIZE;g++)2===a.sum[f][g]&&(d(a,{dir:"hor",row:f,col:g},b,c,e),d(a,{dir:"hor",row:f+1,col:g},b,c,e),d(a,{dir:"ver",row:f,col:g},b,c,e),d(a,{dir:"ver",row:f,col:g+1},b,c,e));return c.length>=1?c:void 0}function f(a,b,c){var d=alphaBetaService.alphaBetaDecision([null,{set:{key:"board",value:a}}],b,h,g,"?debug"===window.location.search?i:null,c);return d}function g(a){if(a[0].endMatch){var b=a[0].endMatch.endMatchScores;return b[0]>b[1]?Number.POSITIVE_INFINITY:b[0]<b[1]?Number.NEGATIVE_INFINITY:0}return a[1].set?a[1].set.value.score[0]-a[1].set.value.score[1]:0}function h(a,b){return e(a[1].set.value,b)}function i(a){return"\n"+a[1].set.value.join("\n")+"\n"}a.findComputerMove=b,a.getPossibleMoves=e,a.createComputerMove=f}(aiService||(aiService={}));
//# sourceMappingURL=everything.min.js.map
var gameLogic;!function(a){function b(a,b){for(var c=[],d=0;a>d;d++){for(var e=[],f=0;b>f;f++)e[f]=[];c[d]=e}return c}function c(){var c={};c.isGameOver=!1,c.switchTurn=!0,c.sumAllEdges=0,c.score=[0,0],c.chains=[],c.hor=b(a.ROWSIZE+1,a.COLSIZE);for(var d=0;d<a.ROWSIZE+1;++d)for(var e=0;e<a.COLSIZE;++e)c.hor[d][e]=0;c.ver=b(a.ROWSIZE,a.COLSIZE+1);for(var d=0;d<a.ROWSIZE;++d)for(var e=0;e<a.COLSIZE+1;++e)c.ver[d][e]=0;c.color=b(a.ROWSIZE,a.COLSIZE),c.sum=b(a.ROWSIZE,a.COLSIZE);for(var d=0;d<a.ROWSIZE;++d)for(var e=0;e<a.COLSIZE;++e)c.color[d][e]="",c.sum[d][e]=0;return c}function d(b){if(b||console.log("board is undefined"),console.log("isGameOver="+b.isGameOver," switchTurn="+b.switchTurn," sumAllEdges="+b.sumAllEdges," score="+b.score),b.hor){var c="";c+="hor: [";for(var d=0;d<a.ROWSIZE+1;++d){c+="[";for(var e=0;e<a.COLSIZE;++e)c=c+b.hor[d][e]+", ";c+="]"}c+="]",console.log(c)}if(b.ver){var c="";c+="ver: [";for(var d=0;d<a.ROWSIZE;++d){c+="[";for(var e=0;e<a.COLSIZE+1;++e)c=c+b.ver[d][e]+", ";c+="]"}c+="]",console.log(c)}if(b.sum){var c="";c+="sum: [";for(var d=0;d<a.ROWSIZE;++d){c+="[";for(var e=0;e<a.COLSIZE;++e)c=c+b.sum[d][e]+", ";c+="]"}c+="]",console.log(c)}if(b.color){var c="";c+="color: [";for(var d=0;d<a.ROWSIZE;++d){c+="[";for(var e=0;e<a.COLSIZE;++e)c=c+b.color[d][e]+", ";c+="]"}c+="]",console.log(c)}}function e(a){var b="";b=a.dir+":"+a.row+"x"+a.col,console.log(b)}function f(b,c,d,e,f){b.switchTurn=!0;var g=angular.copy(b);return"hor"===c?(g.hor[d][e]=1,0!==d&&(g.sum[d-1][e]+=1,4===g.sum[d-1][e]&&(console.log("set switchTurn to false"),g.switchTurn=!1,0===f?(g.color[d-1][e]="YOU",g.score[0]++):(g.color[d-1][e]="ME",g.score[1]++))),d!==a.ROWSIZE&&(g.sum[d][e]+=1,4===g.sum[d][e]&&(console.log("set switchTurn to false"),g.switchTurn=!1,0===f?(g.color[d][e]="YOU",g.score[0]++):(g.color[d][e]="ME",g.score[1]++)))):(g.ver[d][e]=1,0!==e&&(g.sum[d][e-1]+=1,4===g.sum[d][e-1]&&(console.log("set switchTurn to false"),g.switchTurn=!1,0===f?(g.color[d][e-1]="YOU",g.score[0]++):(g.color[d][e-1]="ME",g.score[1]++))),e!==a.COLSIZE&&(g.sum[d][e]+=1,4===g.sum[d][e]&&(console.log("set switchTurn to false"),g.switchTurn=!1,0===f?(g.color[d][e]="YOU",g.score[0]++):(g.color[d][e]="ME",g.score[1]++)))),g.sumAllEdges++,g.sumAllEdges===(a.ROWSIZE+1)*a.COLSIZE+a.ROWSIZE*(a.COLSIZE+1)&&(g.isGameOver=!0),g}function g(a,b,d,e,g){if(a||(a=c()),"hor"===b&&1===a.hor[d][e]||"ver"===b&&1===a.ver[d][e])throw new Error("One can only make a move in an empty position!");if(a.isGameOver)throw new Error("Can only make a move if the game is not over!");var h,i=f(a,b,d,e,g);h=i.isGameOver?{endMatch:{endMatchScores:i.score}}:i.switchTurn?{setTurn:{turnIndex:1-g}}:{setTurn:{turnIndex:g}};var j={dir:b,row:d,col:e};return[h,{set:{key:"board",value:i}},{set:{key:"delta",value:j}}]}function h(a){var b=a.move,c=a.turnIndexBeforeMove,d=a.stateBeforeMove;try{var e=b[2].set.value,f=e.dir,h=e.row,i=e.col,j=d.board,k=g(j,f,h,i,c);if(!angular.equals(b,k))return!1}catch(l){return!1}return!0}a.ROWSIZE=7,a.COLSIZE=7,a.getInitialBoard=c,a.printBoard=d,a.printDelta=e,a.updateBoard=f,a.createMove=g,a.isMoveOk=h}(gameLogic||(gameLogic={}));var game;!function(a){function b(){console.log("Translation of 'RULES_OF_DOTS_AND_BOXES' are "+translate("RULES_OF_DOTS_AND_BOXES")),resizeGameAreaService.setWidthToHeight(1),gameService.setGame({minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:gameLogic.isMoveOk,updateUI:e}),document.addEventListener("animationend",c,!1),document.addEventListener("webkitAnimationEnd",c,!1),document.addEventListener("oanimationend",c,!1)}function c(){$rootScope.$apply(function(){log.info("Animation ended"),p=!0,r&&d()})}function d(){gameService.makeMove(aiService.findComputerMove(t))}function e(a){p=!1,t=a,s=a.stateAfterMove,s.board||(s.board=gameLogic.getInitialBoard()),q=a.turnIndexAfterMove>=0&&a.yourPlayerIndex===a.turnIndexAfterMove,r=q&&""===a.playersInfo[a.yourPlayerIndex].playerId,r&&(q=!1,s.delta||d())}function f(a,b){if(log.info(["Clicked on cell:",a,b]),q){if("?throwException"===window.location.search)throw new Error("Throwing the error because URL has '?throwException'");var c=g(a,b);"hor"!==c.dir&&"ver"!==c.dir?log.info("Clicked on non-action part"):(log.info(c.dir,c.row,c.col),gameLogic.printBoard(s.board),h(c.dir,c.row,c.col))}}function g(a,b){var c={};return a%2==0&&b%2==0?c.dir="corner":a%2==1&&b%2==1?(c.dir="cell",c.row=Math.floor(a/2),c.col=Math.floor(b/2)):a%2==0?(c.dir="hor",c.row=Math.floor(a/2),c.col=Math.floor(b/2)):(c.dir="ver",c.row=Math.floor(a/2),c.col=Math.floor(b/2)),c}function h(a,b,c){if(q)try{var d=gameLogic.createMove(s.board,a,b,c,t.turnIndexAfterMove);gameService.makeMove(d)}catch(e){return void log.info(["Cell is already full in position:",a,b,c])}}function i(a,b){var c=g(a,b),d="";return"cell"===c.dir&&(d=s.board.color[a][b]),""!==d}function j(a,b){var c=g(a,b);return"hor"===c.dir?1===s.board.hor[c.row][c.col]:"ver"===c.dir?1===s.board.ver[c.row][c.col]:!1}function k(a,b){var c=g(a,b);return angular.equals(c,s.delta)}function l(a,b){var c=g(a,b);return"cell"===c.dir?("YOU"===s.board.color[c.row][c.col]&&console.log(c.dir,c.row,c.col),"YOU"===s.board.color[c.row][c.col]):!1}function m(a,b){var c=g(a,b);return"cell"===c.dir?("ME"===s.board.color[c.row][c.col]&&console.log(c.dir,c.row,c.col),"ME"===s.board.color[c.row][c.col]):!1}function n(a,b){var c=g(a,b);return!p&&s.delta&&s.delta.row===c.row&&s.delta.col===c.col&&s.delta.dir===c.dir}function o(a){return Math.floor(a/2)}var p=!1,q=!1,r=!1,s=null,t=null;a.isHelpModalShown=!1,a.init=b,a.cellClicked=f,a.shouldShowImage=i,a.isEdgeFilled=j,a.isNewlyFilledEdge=k,a.isCellFilled_Player0=l,a.isCellFilled_Player1=m,a.shouldSlowlyAppear=n,a.divideByTwoThenFloor=o}(game||(game={})),angular.module("myApp",["ngTouch","ui.bootstrap","gameServices"]).run(function(){$rootScope.game=game,translate.setLanguage("en",{RULES_OF_DOTS_AND_BOXES:"Rules of Dots_and_Boxes",RULES_SLIDE1:"Starting with an empty grid of edges and cells.\n One player fills an empty horizontal or vertical edge.\n Players switch turns if did not complete a cell.",RULES_SLIDE2:"A player who completes the fourth side of a cell earns one point and takes another turn.\n When all the cells are filled, whoever earns the higher score wins.",CLOSE:"Close"}),game.init()});var aiService;!function(a){function b(a){return e(a.stateAfterMove.board,a.turnIndexAfterMove,{millisecondsLimit:1e3})}function c(a){for(var b="possible moves:",c=0;c<a.length;++c)b=b+a[c][2].set.value.dir+":"+a[c][2].set.value.row+"x"+a[c][2].set.value.col+",";console.log("possibleMoves.length = "+a.length),console.log(b)}function d(a,b){for(var c=[],d=0;d<gameLogic.ROWSIZE+1;d++)for(var e=0;e<gameLogic.COLSIZE;e++)if(console.log("i="+d+",j="+e+", "),0===a.hor[d][e]&&(0!==d&&d!==gameLogic.ROWSIZE&&(3===a.sum[d-1][e]||3===a.sum[d][e])||0===d&&3===a.sum[d][e]||d===gameLogic.ROWSIZE&&3===a.sum[d-1][e]))try{c.push(gameLogic.createMove(a,"hor",d,e,b))}catch(f){}for(var d=0;d<gameLogic.ROWSIZE;d++)for(var e=0;e<gameLogic.COLSIZE+1;e++)if(0===a.ver[d][e]&&(0!==e&&e!==gameLogic.COLSIZE&&(3===a.sum[d][e-1]||3===a.sum[d][e])||0===e&&3===a.sum[d][e]||e===gameLogic.COLSIZE&&3===a.sum[d][e-1]))try{c.push(gameLogic.createMove(a,"ver",d,e,b))}catch(f){}if(c.length>=1)return c;for(var d=0;d<gameLogic.ROWSIZE+1;d++)for(var e=0;e<gameLogic.COLSIZE;e++)if(0===a.hor[d][e]&&(0!==d&&d!==gameLogic.ROWSIZE&&2!==a.sum[d-1][e]&&2!==a.sum[d][e]||0===d&&2!==a.sum[d][e]||d===gameLogic.ROWSIZE&&2!==a.sum[d-1][e]))try{c.push(gameLogic.createMove(a,"hor",d,e,b))}catch(f){}for(var d=0;d<gameLogic.ROWSIZE;d++)for(var e=0;e<gameLogic.COLSIZE+1;e++)if(0===a.ver[d][e]&&(0!==e&&e!==gameLogic.COLSIZE&&2!==a.sum[d][e-1]&&2!==a.sum[d][e]||0===e&&2!==a.sum[d][e]||e===gameLogic.COLSIZE&&2!==a.sum[d][e-1]))try{c.push(gameLogic.createMove(a,"ver",d,e,b))}catch(f){}if(c.length>=1)return c;for(var d=0;d<gameLogic.ROWSIZE+1;d++)for(var e=0;e<gameLogic.COLSIZE;e++)if(0===a.hor[d][e])try{c.push(gameLogic.createMove(a,"hor",d,e,b))}catch(f){}for(var d=0;d<gameLogic.ROWSIZE;d++)for(var e=0;e<gameLogic.COLSIZE+1;e++)if(0===a.ver[d][e])try{c.push(gameLogic.createMove(a,"ver",d,e,b))}catch(f){}return c}function e(a,b){var e=d(a,b);c(e);var f=Math.floor(e.length*Math.random());return e[f]}a.findComputerMove=b,a.getPossibleMoves=d,a.createComputerMove=e}(aiService||(aiService={}));
//# sourceMappingURL=everything.min.js.map